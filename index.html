<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T·ª´ v·ª±ng 30 m·ª•c ‚Äî file ƒë∆°n</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}
    :root{
      --primary:#3b82f6;--primary-dark:#1d4ed8;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;
      --bg:#ffffff;--bg-secondary:#f8fafc;--bg-tertiary:#f1f5f9;
      --fg:#0f172a;--fg-secondary:#475569;--fg-muted:#64748b;
      --border:#e2e8f0;--border-hover:#cbd5e1;
      --shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --gradient:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    [data-theme="dark"]{
      --bg:#0f172a;--bg-secondary:#1e293b;--bg-tertiary:#334155;
      --fg:#f8fafc;--fg-secondary:#cbd5e1;--fg-muted:#94a3b8;
      --border:#334155;--border-hover:#475569;
      --shadow:0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
      --shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
    }
    body{margin:0;background:var(--bg);color:var(--fg);font-family:"Noto Sans","Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,Arial;transition:all 0.3s ease;line-height:1.6}
    
    /* Header */
    header{background:var(--gradient);color:white;padding:2rem 1rem;text-align:center;position:relative;overflow:hidden}
    header::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="3" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');opacity:0.3}
    h1{margin:0 0 0.5rem 0;font-size:clamp(1.8rem,4vw,2.5rem);font-weight:700;position:relative;z-index:1}
    .sub{margin:0;opacity:0.9;font-size:1.1rem;position:relative;z-index:1}
    
    /* Navigation */
    .nav{background:var(--bg);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);box-shadow:var(--shadow)}
    .nav-content{max-width:1200px;margin:0 auto;padding:1rem;display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
    
    /* Theme Toggle */
    .theme-toggle{background:var(--bg-secondary);border:1px solid var(--border);border-radius:50px;padding:0.5rem;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all 0.3s ease;min-width:auto}
    .theme-toggle:hover{background:var(--bg-tertiary);border-color:var(--border-hover)}
    
    /* Controls */
    .controls{background:var(--bg-secondary);margin:1rem;border-radius:12px;padding:1.5rem;box-shadow:var(--shadow);display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
    input[type=search]{flex:1;min-width:280px;padding:0.75rem 1rem;border:2px solid var(--border);border-radius:10px;background:var(--bg);color:var(--fg);font-size:1rem;transition:all 0.3s ease}
    input[type=search]:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgb(59 130 246 / 0.1)}
    
    /* Buttons */
    button{border:2px solid var(--border);background:var(--bg);color:var(--fg);border-radius:10px;padding:0.75rem 1.5rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:0.5rem;font-size:0.95rem}
    button:hover{border-color:var(--primary);color:var(--primary);transform:translateY(-2px);box-shadow:var(--shadow)}
    button:active{transform:translateY(0)}
    .btn-primary{background:var(--primary);color:white;border-color:var(--primary)}
    .btn-primary:hover{background:var(--primary-dark);border-color:var(--primary-dark);color:white}
    
    /* Main Content */
    main{max-width:1200px;margin:0 auto;padding:1rem}
    .card{background:var(--bg);border-radius:12px;box-shadow:var(--shadow);margin-bottom:2rem}
    .table-container{overflow:auto;border-radius:12px}
    
    /* Table */
    table{width:100%;border-collapse:collapse}
    thead{background:var(--bg-secondary)}
    thead th{padding:1rem;text-align:left;font-weight:600;color:var(--fg-secondary);border-bottom:2px solid var(--border);position:sticky;top:0;z-index:10;background:var(--bg-secondary)}
    tbody td{padding:1rem;border-bottom:1px solid var(--border);vertical-align:top;transition:all 0.2s ease}
    tbody tr:hover{background:var(--bg-secondary);transform:scale(1.01)}
    .idx{width:60px;color:var(--fg-muted);font-weight:600}
    .chinese{font-size:1.4rem;font-weight:600;color:var(--primary)}
    .pinyin{font-style:italic;color:var(--fg-secondary);font-size:1.1rem}
    .vietnamese{font-size:1rem}
    
    /* Study Tools */
    .study-tools{display:flex;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}
    .tool-card{background:var(--bg);border:2px solid var(--border);border-radius:12px;padding:1.5rem;flex:1;min-width:250px;text-align:center;cursor:pointer;transition:all 0.3s ease}
    .tool-card:hover{border-color:var(--primary);transform:translateY(-4px);box-shadow:var(--shadow-lg)}
    .tool-icon{font-size:2rem;margin-bottom:0.5rem}
    .tool-title{font-weight:600;margin-bottom:0.25rem}
    .tool-desc{color:var(--fg-muted);font-size:0.9rem}
    
    /* Stats */
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}
    .stat-card{background:var(--bg);border-radius:12px;padding:1.5rem;text-align:center;box-shadow:var(--shadow);border-left:4px solid var(--primary)}
    .stat-number{font-size:2rem;font-weight:700;color:var(--primary);margin-bottom:0.25rem}
    .stat-label{color:var(--fg-muted);font-size:0.9rem}
    
    /* Responsive */
    @media (max-width: 768px){
      .nav-content,.controls{flex-direction:column;align-items:stretch}
      input[type=search]{min-width:auto}
      .study-tools{flex-direction:column}
      table{font-size:0.9rem}
      thead th,tbody td{padding:0.75rem 0.5rem}
      .chinese{font-size:1.2rem}
    }
    
    /* Animations */
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn 0.5s ease-out}
    
    /* Modal */
    .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;z-index:1000;backdrop-filter:blur(5px)}
    .modal-content{background:var(--bg);border-radius:12px;padding:2rem;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:var(--shadow-lg)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
    .modal-title{font-size:1.5rem;font-weight:700;margin:0}
    .close-btn{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--fg-muted);padding:0}
    .close-btn:hover{color:var(--danger)}
  </style>
</head>
<body>
  <header>
    <h1>üìö T·ª´ v·ª±ng Trung-Vi·ªát</h1>
    <p class="sub">·ª®ng d·ª•ng h·ªçc t·ª´ v·ª±ng ti·∫øng Trung v·ªõi nhi·ªÅu t√≠nh nƒÉng th√¥ng minh</p>
  </header>
  
  <nav class="nav">
    <div class="nav-content">
      <button class="theme-toggle" id="themeToggle">
        <span id="themeIcon">üåô</span>
        <span id="themeText">Ch·∫ø ƒë·ªô t·ªëi</span>
      </button>
    </div>
  </nav>

  <main>
    <!-- Stats -->
    <div class="stats fade-in">
      <div class="stat-card">
        <div class="stat-number" id="totalWords">30</div>
        <div class="stat-label">T·ªïng t·ª´ v·ª±ng</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="studiedWords">0</div>
        <div class="stat-label">ƒê√£ h·ªçc</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="favoriteWords">0</div>
        <div class="stat-label">Y√™u th√≠ch</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="accuracy">0%</div>
        <div class="stat-label">ƒê·ªô ch√≠nh x√°c</div>
      </div>
    </div>

    <!-- Study Tools -->
    <div class="study-tools fade-in">
      <div class="tool-card" onclick="openFlashcards()">
        <div class="tool-icon">üóÇÔ∏è</div>
        <div class="tool-title">Flashcard</div>
        <div class="tool-desc">H·ªçc t·ª´ v·ª±ng v·ªõi th·∫ª ghi nh·ªõ</div>
      </div>
      <div class="tool-card" onclick="openQuiz()">
        <div class="tool-icon">üß†</div>
        <div class="tool-title">Ki·ªÉm tra</div>
        <div class="tool-desc">L√†m b√†i quiz ƒë·ªÉ √¥n t·∫≠p</div>
      </div>
      <div class="tool-card" onclick="getRandomWord()">
        <div class="tool-icon">üé≤</div>
        <div class="tool-title">T·ª´ ng·∫´u nhi√™n</div>
        <div class="tool-desc">Luy·ªán t·ª´ v·ª±ng b·∫•t k·ª≥</div>
      </div>
    </div>

    <!-- Search Controls -->
    <div class="controls fade-in">
      <input id="q" type="search" placeholder="üîç T√¨m ki·∫øm: Ë¢´ / bei / 'n·ªó l·ª±c'‚Ä¶" autofocus />
      <button id="export">üì• Xu·∫•t CSV</button>
      <button id="clear">üóëÔ∏è X√≥a t√¨m</button>
      <button id="randomBtn">üé≤ Ng·∫´u nhi√™n</button>
    </div>

    <!-- Vocabulary Table -->
    <div class="card fade-in">
      <div class="table-container">
        <table id="tbl">
          <thead>
            <tr>
              <th class="idx">#</th>
              <th>ÁπÅÈ´î</th>
              <th>Pinyin</th>
              <th>Nghƒ©a ti·∫øng Vi·ªát</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Flashcard Modal -->
  <div class="modal" id="flashcardModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üóÇÔ∏è Flashcard</h2>
        <button class="close-btn" onclick="closeModal('flashcardModal')">&times;</button>
      </div>
      <div id="flashcardContent">
        <div style="text-align:center;padding:2rem">
          <div id="flashcardChinese" style="font-size:3rem;margin-bottom:1rem;color:var(--primary)"></div>
          <div id="flashcardPinyin" style="font-size:1.5rem;color:var(--fg-secondary);margin-bottom:1rem;display:none"></div>
          <div id="flashcardVietnamese" style="font-size:1.2rem;display:none"></div>
          <div style="margin-top:2rem;display:flex;gap:1rem;justify-content:center">
            <button id="revealBtn" class="btn-primary">Hi·ªán ƒë√°p √°n</button>
            <button id="nextCardBtn" style="display:none">T·ª´ ti·∫øp theo</button>
            <button onclick="speakChinese()" style="background:var(--success);color:white;border-color:var(--success)">üîä Ph√°t √¢m</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz Modal -->
  <div class="modal" id="quizModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üß† Ki·ªÉm tra t·ª´ v·ª±ng</h2>
        <button class="close-btn" onclick="closeModal('quizModal')">&times;</button>
      </div>
      <div id="quizContent">
        <div id="quizQuestion" style="text-align:center;padding:2rem">
          <div id="quizChinese" style="font-size:2.5rem;margin-bottom:1rem;color:var(--primary)"></div>
          <div id="quizPinyin" style="font-size:1.2rem;color:var(--fg-secondary);margin-bottom:2rem"></div>
          <div id="quizOptions" style="display:grid;gap:1rem;max-width:400px;margin:0 auto"></div>
          <div id="quizResult" style="margin-top:1rem;display:none"></div>
          <div style="margin-top:2rem">
            <button id="nextQuestionBtn" style="display:none" class="btn-primary">C√¢u ti·∫øp theo</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    const DATA = [{"ÁπÅÈ´î":"Ë¢´","Pinyin":"b√®i","Nghƒ©a ti·∫øng Vi·ªát":"b·ªã (b·ªã ƒë·ªông)"},{"ÁπÅÈ´î":"ÈÅäÊà≤","Pinyin":"y√≥ux√¨","Nghƒ©a ti·∫øng Vi·ªát":"tr√≤ ch∆°i"},{"ÁπÅÈ´î":"ÂêÉÂÖâ‰∫Ü","Pinyin":"chƒ´ guƒÅng le","Nghƒ©a ti·∫øng Vi·ªát":"ƒÉn h·∫øt r·ªìi"},{"ÁπÅÈ´î":"ÂÖ∂‰ªñÂú∞Êñπ","Pinyin":"q√≠tƒÅ d√¨fƒÅng","Nghƒ©a ti·∫øng Vi·ªát":"n∆°i kh√°c"},{"ÁπÅÈ´î":"Êê¨‰∏ç‰∫Ü","Pinyin":"bƒÅn b√π li«éo","Nghƒ©a ti·∫øng Vi·ªát":"kh√¥ng d·ªçn\/kh√¥ng mang ƒë∆∞·ª£c"},{"ÁπÅÈ´î":"ÂÖ¨ÂØì","Pinyin":"g≈çngy√π","Nghƒ©a ti·∫øng Vi·ªát":"cƒÉn h·ªô"},{"ÁπÅÈ´î":"ÊóÖÈÅä","Pinyin":"l«öy√≥u","Nghƒ©a ti·∫øng Vi·ªát":"du l·ªãch"},{"ÁπÅÈ´î":"ËààË∂£","Pinyin":"x√¨ngq√π","Nghƒ©a ti·∫øng Vi·ªát":"h·ª©ng th√∫, s·ªü th√≠ch"},{"ÁπÅÈ´î":"Êéâ","Pinyin":"di√†o","Nghƒ©a ti·∫øng Vi·ªát":"r∆°i, m·∫•t"},{"ÁπÅÈ´î":"Á∑äÂºµ‰∫Ü","Pinyin":"j«ênzhƒÅng le","Nghƒ©a ti·∫øng Vi·ªát":"cƒÉng th·∫≥ng r·ªìi"},{"ÁπÅÈ´î":"Â∞èÂøÉ","Pinyin":"xi«éoxƒ´n","Nghƒ©a ti·∫øng Vi·ªát":"c·∫©n th·∫≠n"},{"ÁπÅÈ´î":"Êñ∞ÈÆÆ","Pinyin":"xƒ´nxiƒÅn","Nghƒ©a ti·∫øng Vi·ªát":"t∆∞∆°i, m·ªõi (th∆∞·ªùng d√πng cho ƒë·ªì ƒÉn)"},{"ÁπÅÈ´î":"Ëµ∑Â∫ä","Pinyin":"q«êchu√°ng","Nghƒ©a ti·∫øng Vi·ªát":"th·ª©c d·∫≠y"},{"ÁπÅÈ´î":"È§Ö‰πæ","Pinyin":"b«ênggƒÅn","Nghƒ©a ti·∫øng Vi·ªát":"b√°nh quy"},{"ÁπÅÈ´î":"ËÄå‰∏î","Pinyin":"√©rqiƒõ","Nghƒ©a ti·∫øng Vi·ªát":"h∆°n n·ªØa, m√† c√≤n"},{"ÁπÅÈ´î":"ÈõñÁÑ∂","Pinyin":"suƒ´r√°n","Nghƒ©a ti·∫øng Vi·ªát":"m·∫∑c d√π"},{"ÁπÅÈ´î":"Áõ∏‰ø°","Pinyin":"xiƒÅngx√¨n","Nghƒ©a ti·∫øng Vi·ªát":"tin t∆∞·ªüng"},{"ÁπÅÈ´î":"ÊñºÊòØ","Pinyin":"y√∫sh√¨","Nghƒ©a ti·∫øng Vi·ªát":"th·∫ø l√†, v·∫≠y n√™n"},{"ÁπÅÈ´î":"‰øùË≠∑","Pinyin":"b«éoh√π","Nghƒ©a ti·∫øng Vi·ªát":"b·∫£o v·ªá"},{"ÁπÅÈ´î":"‰ΩúËÄÖ","Pinyin":"zu√≤zhƒõ","Nghƒ©a ti·∫øng Vi·ªát":"t√°c gi·∫£"},{"ÁπÅÈ´î":"ËÅäÂ§©","Pinyin":"li√°otiƒÅn","Nghƒ©a ti·∫øng Vi·ªát":"n√≥i chuy·ªán, t√°n g·∫´u"},{"ÁπÅÈ´î":"Ê≥®ÊÑè","Pinyin":"zh√πy√¨","Nghƒ©a ti·∫øng Vi·ªát":"ch√∫ √Ω"},{"ÁπÅÈ´î":"Ê†°Èï∑","Pinyin":"xi√†ozh«éng","Nghƒ©a ti·∫øng Vi·ªát":"hi·ªáu tr∆∞·ªüng"},{"ÁπÅÈ´î":"ÈÇÄË´ã","Pinyin":"yƒÅoq«êng","Nghƒ©a ti·∫øng Vi·ªát":"m·ªùi"},{"ÁπÅÈ´î":"Ë¨õÂÆå","Pinyin":"ji«éng w√°n","Nghƒ©a ti·∫øng Vi·ªát":"n√≥i xong"},{"ÁπÅÈ´î":"Êé•Ëëó","Pinyin":"jiƒìzhe","Nghƒ©a ti·∫øng Vi·ªát":"ti·∫øp theo"},{"ÁπÅÈ´î":"ÂØ¶Èöõ","Pinyin":"sh√≠j√¨","Nghƒ©a ti·∫øng Vi·ªát":"th·ª±c t·∫ø"},{"ÁπÅÈ´î":"ÂÖ¨Âëä","Pinyin":"g≈çngg√†o","Nghƒ©a ti·∫øng Vi·ªát":"th√¥ng b√°o"},{"ÁπÅÈ´î":"Âä™Âäõ","Pinyin":"n«îl√¨","Nghƒ©a ti·∫øng Vi·ªát":"n·ªó l·ª±c, c·ªë g·∫Øng"},{"ÁπÅÈ´î":"‰∫ãÊÉÖ","Pinyin":"sh√¨q√≠ng","Nghƒ©a ti·∫øng Vi·ªát":"s·ª± vi·ªác, chuy·ªán"}];
    
    // Global state
    let currentTheme = localStorage.getItem('theme') || 'light';
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let studiedWords = JSON.parse(localStorage.getItem('studiedWords') || '[]');
    let quizStats = JSON.parse(localStorage.getItem('quizStats') || '{"correct": 0, "total": 0}');
    let currentFlashcard = 0;
    let currentQuiz = null;
    
    // DOM elements
    const q = document.getElementById('q');
    const tbody = document.querySelector('#tbl tbody');
    
    // Initialize app
    function init() {
      applyTheme(currentTheme);
      updateStats();
      render();
      setupEventListeners();
    }
    
    // Theme management
    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(currentTheme);
      localStorage.setItem('theme', currentTheme);
    }
    
    function applyTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      const themeIcon = document.getElementById('themeIcon');
      const themeText = document.getElementById('themeText');
      if (theme === 'dark') {
        themeIcon.textContent = '‚òÄÔ∏è';
        themeText.textContent = 'Ch·∫ø ƒë·ªô s√°ng';
      } else {
        themeIcon.textContent = 'üåô';
        themeText.textContent = 'Ch·∫ø ƒë·ªô t·ªëi';
      }
    }
    
    // Statistics
    function updateStats() {
      document.getElementById('totalWords').textContent = DATA.length;
      document.getElementById('studiedWords').textContent = studiedWords.length;
      document.getElementById('favoriteWords').textContent = favorites.length;
      const accuracy = quizStats.total > 0 ? Math.round((quizStats.correct / quizStats.total) * 100) : 0;
      document.getElementById('accuracy').textContent = accuracy + '%';
    }
    
    // Utility functions
    function strip(s) {
      return (s || '').toString().normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    }
    
    function isFavorite(word) {
      return favorites.some(fav => fav['ÁπÅÈ´î'] === word['ÁπÅÈ´î']);
    }
    
    function toggleFavorite(word) {
      const index = favorites.findIndex(fav => fav['ÁπÅÈ´î'] === word['ÁπÅÈ´î']);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push(word);
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateStats();
      render();
    }
    
    function markAsStudied(word) {
      if (!studiedWords.some(studied => studied['ÁπÅÈ´î'] === word['ÁπÅÈ´î'])) {
        studiedWords.push(word);
        localStorage.setItem('studiedWords', JSON.stringify(studiedWords));
        updateStats();
      }
    }
    
    // Render table
    function render() {
      const term = strip(q.value.trim());
      const rows = DATA.filter(r => !term || strip([r["ÁπÅÈ´î"], r["Pinyin"], r["Nghƒ©a ti·∫øng Vi·ªát"]].join(' ')).includes(term));
      
      tbody.innerHTML = rows.map((r, i) => `
        <tr>
          <td class="idx">${i + 1}</td>
          <td class="chinese">${r["ÁπÅÈ´î"]}</td>
          <td class="pinyin">${r["Pinyin"]}</td>
          <td class="vietnamese">${r["Nghƒ©a ti·∫øng Vi·ªát"]}</td>
          <td>
            <button onclick="toggleFavorite(DATA[${DATA.indexOf(r)}])" style="background:${isFavorite(r) ? 'var(--danger)' : 'var(--bg)'};color:${isFavorite(r) ? 'white' : 'var(--fg)'};border-color:${isFavorite(r) ? 'var(--danger)' : 'var(--border)'};padding:0.5rem;margin-right:0.5rem">
              ${isFavorite(r) ? '‚ù§Ô∏è' : 'ü§ç'}
            </button>
            <button onclick="speakChinese('${r["ÁπÅÈ´î"]}')" style="background:var(--success);color:white;border-color:var(--success);padding:0.5rem">
              üîä
            </button>
          </td>
        </tr>
      `).join('');
    }
    
    // Audio pronunciation
    function speakChinese(text = null) {
      if (!text) {
        const flashcardChinese = document.getElementById('flashcardChinese');
        text = flashcardChinese ? flashcardChinese.textContent : '';
      }
      
      if ('speechSynthesis' in window && text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-CN';
        utterance.rate = 0.8;
        speechSynthesis.speak(utterance);
      }
    }
    
    // Export CSV
    function exportCSV() {
      const header = ["#", "ÁπÅÈ´î", "Pinyin", "Nghƒ©a ti·∫øng Vi·ªát"];
      const term = strip(q.value.trim());
      const rows = DATA.filter(r => !term || strip([r["ÁπÅÈ´î"], r["Pinyin"], r["Nghƒ©a ti·∫øng Vi·ªát"]].join(' ')).includes(term));
      const lines = [header.join(',')].concat(rows.map((r, i) => [i + 1, r["ÁπÅÈ´î"], r["Pinyin"], `"${r["Nghƒ©a ti·∫øng Vi·ªát"].replace(/"/g, '""')}"`].join(',')));
      const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'vocab-30.csv';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Random word
    function getRandomWord() {
      const randomWord = DATA[Math.floor(Math.random() * DATA.length)];
      q.value = randomWord["ÁπÅÈ´î"];
      render();
      q.focus();
    }
    
    // Modal management
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    // Flashcard functionality
    function openFlashcards() {
      currentFlashcard = 0;
      showFlashcard();
      document.getElementById('flashcardModal').style.display = 'flex';
    }
    
    function showFlashcard() {
      if (currentFlashcard >= DATA.length) currentFlashcard = 0;
      
      const word = DATA[currentFlashcard];
      document.getElementById('flashcardChinese').textContent = word["ÁπÅÈ´î"];
      document.getElementById('flashcardPinyin').textContent = word["Pinyin"];
      document.getElementById('flashcardVietnamese').textContent = word["Nghƒ©a ti·∫øng Vi·ªát"];
      
      // Reset visibility
      document.getElementById('flashcardPinyin').style.display = 'none';
      document.getElementById('flashcardVietnamese').style.display = 'none';
      document.getElementById('revealBtn').style.display = 'inline-flex';
      document.getElementById('nextCardBtn').style.display = 'none';
    }
    
    function revealAnswer() {
      document.getElementById('flashcardPinyin').style.display = 'block';
      document.getElementById('flashcardVietnamese').style.display = 'block';
      document.getElementById('revealBtn').style.display = 'none';
      document.getElementById('nextCardBtn').style.display = 'inline-flex';
      
      markAsStudied(DATA[currentFlashcard]);
    }
    
    function nextFlashcard() {
      currentFlashcard = (currentFlashcard + 1) % DATA.length;
      showFlashcard();
    }
    
    // Quiz functionality
    function openQuiz() {
      startNewQuiz();
      document.getElementById('quizModal').style.display = 'flex';
    }
    
    function startNewQuiz() {
      const randomWord = DATA[Math.floor(Math.random() * DATA.length)];
      const otherWords = DATA.filter(w => w !== randomWord);
      const wrongOptions = [];
      
      while (wrongOptions.length < 3 && otherWords.length > 0) {
        const randomIndex = Math.floor(Math.random() * otherWords.length);
        wrongOptions.push(otherWords.splice(randomIndex, 1)[0]);
      }
      
      const allOptions = [randomWord, ...wrongOptions].sort(() => Math.random() - 0.5);
      
      currentQuiz = {
        correct: randomWord,
        options: allOptions,
        answered: false
      };
      
      document.getElementById('quizChinese').textContent = randomWord["ÁπÅÈ´î"];
      document.getElementById('quizPinyin').textContent = randomWord["Pinyin"];
      
      const optionsContainer = document.getElementById('quizOptions');
      optionsContainer.innerHTML = allOptions.map((option, i) => `
        <button onclick="selectQuizOption(${i})" style="padding:1rem;border:2px solid var(--border);border-radius:8px;background:var(--bg);color:var(--fg);cursor:pointer;transition:all 0.3s ease" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--border)'">
          ${option["Nghƒ©a ti·∫øng Vi·ªát"]}
        </button>
      `).join('');
      
      document.getElementById('quizResult').style.display = 'none';
      document.getElementById('nextQuestionBtn').style.display = 'none';
    }
    
    function selectQuizOption(optionIndex) {
      if (currentQuiz.answered) return;
      
      currentQuiz.answered = true;
      const selectedOption = currentQuiz.options[optionIndex];
      const isCorrect = selectedOption === currentQuiz.correct;
      
      // Update quiz stats
      quizStats.total++;
      if (isCorrect) quizStats.correct++;
      localStorage.setItem('quizStats', JSON.stringify(quizStats));
      updateStats();
      
      // Show result
      const resultDiv = document.getElementById('quizResult');
      resultDiv.innerHTML = `
        <div style="padding:1rem;border-radius:8px;background:${isCorrect ? 'var(--success)' : 'var(--danger)'};color:white;margin-top:1rem">
          <strong>${isCorrect ? '‚úÖ Ch√≠nh x√°c!' : '‚ùå Sai r·ªìi!'}</strong><br>
          ƒê√°p √°n ƒë√∫ng: ${currentQuiz.correct["Nghƒ©a ti·∫øng Vi·ªát"]}
        </div>
      `;
      resultDiv.style.display = 'block';
      document.getElementById('nextQuestionBtn').style.display = 'inline-flex';
      
      if (isCorrect) markAsStudied(currentQuiz.correct);
    }
    
    function nextQuestion() {
      startNewQuiz();
    }
    
    // Event listeners
    function setupEventListeners() {
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      document.getElementById('export').addEventListener('click', exportCSV);
      document.getElementById('clear').addEventListener('click', () => { q.value = ''; render(); });
      document.getElementById('randomBtn').addEventListener('click', getRandomWord);
      q.addEventListener('input', render);
      
      // Flashcard events
      document.getElementById('revealBtn').addEventListener('click', revealAnswer);
      document.getElementById('nextCardBtn').addEventListener('click', nextFlashcard);
      document.getElementById('nextQuestionBtn').addEventListener('click', nextQuestion);
      
      // Close modals when clicking outside
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
          e.target.style.display = 'none';
        }
      });
    }
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
