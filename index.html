<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Ti·∫øng Trung Ph·ªìn Th·ªÉ - ƒê√†i Loan</title>
    
    <!-- Tesseract.js for OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #e63946;
            --secondary: #f77f00;
            --accent: #06ffa5;
            --dark: #1d3557;
            --light: #f1faee;
            --success: #2a9d8f;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 80px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: var(--gradient-1);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.95;
            font-weight: 300;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 140px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.05em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #333;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 4px solid #667eea;
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            padding: 35px;
            animation: fadeIn 0.4s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-banner {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            border-left: 5px solid #00acc1;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .info-banner h3 {
            color: #00695c;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-banner p {
            color: #004d40;
            line-height: 1.6;
        }

        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .lesson-card {
            background: var(--gradient-1);
            padding: 30px;
            border-radius: 16px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .lesson-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
        }

        .lesson-card h3 {
            font-size: 1.7em;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .lesson-card .vocab-count {
            font-size: 1em;
            opacity: 0.9;
        }

        .lesson-card .delete-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255,255,255,0.25);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lesson-card .delete-btn:hover {
            background: rgba(255,0,0,0.9);
            transform: rotate(90deg);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 12px;
            margin-bottom: 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-2);
            color: white;
        }

        .btn-success {
            background: var(--gradient-4);
            color: white;
        }

        .btn-info {
            background: var(--gradient-3);
            color: white;
        }

        .btn-outline {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.75);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 92%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-content h2 {
            margin-bottom: 25px;
            color: #667eea;
            font-size: 2em;
        }

        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.05em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.05em;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 180px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .hint {
            font-size: 0.92em;
            color: #666;
            margin-top: 8px;
            line-height: 1.5;
        }

        .vocab-list {
            margin-top: 25px;
        }

        .vocab-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 22px;
            border-radius: 14px;
            margin-bottom: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .vocab-item:hover {
            transform: translateX(8px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .vocab-info {
            flex: 1;
        }

        .vocab-chinese {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 6px;
        }

        .vocab-pinyin {
            color: #666;
            margin-bottom: 4px;
            font-size: 1.05em;
        }

        .vocab-vietnamese {
            color: #333;
            font-size: 1.05em;
        }

        .vocab-actions {
            display: flex;
            gap: 12px;
        }

        .vocab-speak {
            background: var(--gradient-4);
            color: white;
            border: none;
            padding: 12px 22px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1.1em;
        }

        .vocab-speak:hover {
            transform: scale(1.05);
        }

        .vocab-delete {
            background: var(--gradient-2);
            color: white;
            border: none;
            padding: 12px 22px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .vocab-delete:hover {
            transform: scale(1.05);
        }

        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }

        .flashcard {
            width: 550px;
            height: 380px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 12px 45px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
            margin: 25px 0;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 45px;
            border-radius: 20px;
        }

        .flashcard-front {
            background: var(--gradient-1);
            color: white;
        }

        .flashcard-back {
            background: var(--gradient-2);
            color: white;
            transform: rotateY(180deg);
        }

        .flashcard-text {
            font-size: 3.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 22px;
        }

        .flashcard-sub {
            font-size: 1.35em;
            opacity: 0.95;
            text-align: center;
        }

        .speak-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.05em;
            margin-top: 18px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .speak-btn:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.05);
        }

        .flashcard-controls {
            display: flex;
            gap: 22px;
            margin-top: 35px;
        }

        .control-btn {
            padding: 16px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.15em;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.25);
        }

        .control-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .exercise-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .question-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 35px;
            border-radius: 18px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .question-text {
            font-size: 1.6em;
            margin-bottom: 22px;
            color: #333;
            font-weight: 600;
        }

        .question-chinese {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin: 25px 0;
            text-align: center;
        }

        .options {
            display: grid;
            gap: 18px;
            margin-top: 25px;
        }

        .option-btn {
            background: white;
            border: 3px solid #e9ecef;
            padding: 22px;
            border-radius: 12px;
            font-size: 1.15em;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-weight: 500;
        }

        .option-btn:hover:not(.correct):not(.incorrect) {
            border-color: #667eea;
            transform: translateX(8px);
            background: #f8f9ff;
        }

        .option-btn.correct {
            background: var(--gradient-4);
            color: white;
            border-color: transparent;
        }

        .option-btn.incorrect {
            background: var(--gradient-2);
            color: white;
            border-color: transparent;
        }

        .score-display {
            text-align: center;
            font-size: 1.7em;
            margin: 25px 0;
            color: #667eea;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 80px 25px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 5em;
            margin-bottom: 25px;
        }

        .empty-state-text {
            font-size: 1.4em;
        }

        .ocr-upload-area {
            border: 3px dashed #667eea;
            border-radius: 16px;
            padding: 45px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ebff 100%);
            margin: 25px 0;
        }

        .ocr-upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(135deg, #e8ebff 0%, #d8dbff 100%);
            transform: scale(1.02);
        }

        .ocr-upload-area.dragging {
            border-color: #43e97b;
            background: linear-gradient(135deg, #e8fff5 0%, #d8ffe8 100%);
        }

        .ocr-result {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 22px;
            margin-top: 22px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 1.05em;
            line-height: 1.8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 18px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-1);
            transition: width 0.3s;
            border-radius: 10px;
        }

        .prompt-box {
            background: linear-gradient(135deg, #fff9e6 0%, #ffedcc 100%);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .prompt-box h4 {
            color: #f57c00;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .prompt-text {
            background: white;
            padding: 18px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            white-space: pre-wrap;
            border: 1px solid #ffe0b2;
            line-height: 1.7;
        }

        .copy-btn {
            margin-top: 12px;
            background: #ffc107;
            color: #333;
            border: none;
            padding: 10px 22px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #ffb300;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .flashcard {
                width: 95%;
                height: 320px;
            }

            .flashcard-text {
                font-size: 2.5em;
            }

            .lesson-grid {
                grid-template-columns: 1fr;
            }

            .nav-tab {
                padding: 15px 10px;
                font-size: 0.95em;
            }

            .tab-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö H·ªçc Ti·∫øng Trung Ph·ªìn Th·ªÉ</h1>
            <div class="subtitle">ƒê√†i Loan - Traditional Chinese - 100% Offline & Free</div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('lessons')">üìã B√†i h·ªçc</button>
            <button class="nav-tab" onclick="switchTab('flashcards')">üé¥ Flashcards</button>
            <button class="nav-tab" onclick="switchTab('exercises')">‚úçÔ∏è B√†i t·∫≠p</button>
            <button class="nav-tab" onclick="switchTab('ocr')">üì∏ Qu√©t ·∫£nh</button>
            <button class="nav-tab" onclick="switchTab('ai-helper')">ü§ñ AI Helper</button>
        </div>

        <!-- Tab: B√†i h·ªçc -->
        <div id="lessons-tab" class="tab-content active">
            <div class="info-banner">
                <h3>‚ú® Website ho·∫°t ƒë·ªông 100% OFFLINE!</h3>
                <p>T·∫•t c·∫£ t√≠nh nƒÉng ƒë·ªÅu mi·ªÖn ph√≠ v√† kh√¥ng c·∫ßn k·∫øt n·ªëi internet (tr·ª´ OCR c·∫ßn t·∫£i th∆∞ vi·ªán l·∫ßn ƒë·∫ßu). D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u an to√†n tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n.</p>
            </div>
            
            <button class="btn btn-primary" onclick="showAddLessonModal()">‚ûï Th√™m b√†i h·ªçc m·ªõi</button>
            <div id="lesson-list" class="lesson-grid"></div>
        </div>

        <!-- Tab: Flashcards -->
        <div id="flashcards-tab" class="tab-content">
            <div class="form-group">
                <label>Ch·ªçn b√†i h·ªçc:</label>
                <select id="flashcard-lesson-select" onchange="loadFlashcards()" style="width: 100%; padding: 14px; border-radius: 10px; border: 2px solid #e9ecef; font-size: 1.05em;">
                    <option value="">-- Ch·ªçn b√†i h·ªçc --</option>
                </select>
            </div>
            <div id="flashcard-area"></div>
        </div>

        <!-- Tab: B√†i t·∫≠p -->
        <div id="exercises-tab" class="tab-content">
            <div class="form-group">
                <label>Ch·ªçn b√†i h·ªçc:</label>
                <select id="exercise-lesson-select" style="width: 100%; padding: 14px; border-radius: 10px; border: 2px solid #e9ecef; font-size: 1.05em;">
                    <option value="">-- Ch·ªçn b√†i h·ªçc --</option>
                </select>
            </div>
            <button class="btn btn-success" onclick="startExercise()">üéØ B·∫Øt ƒë·∫ßu l√†m b√†i</button>
            <div id="exercise-area"></div>
        </div>

        <!-- Tab: OCR -->
        <div id="ocr-tab" class="tab-content">
            <div class="info-banner">
                <h3>üì∏ Qu√©t ·∫£nh nh·∫≠n di·ªán ch·ªØ Trung</h3>
                <p>Ch·ª•p ho·∫∑c t·∫£i ·∫£nh c√≥ ch·ªØ Trung, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông nh·∫≠n di·ªán v√† hi·ªÉn th·ªã vƒÉn b·∫£n. Sau ƒë√≥ b·∫°n c√≥ th·ªÉ copy v√† th√™m v√†o b√†i h·ªçc.</p>
            </div>

            <div class="ocr-upload-area" id="ocr-drop-zone" onclick="document.getElementById('ocr-file-input').click()">
                <div style="font-size: 4em; margin-bottom: 15px;">üì∑</div>
                <h3 style="margin-bottom: 12px;">Nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh ho·∫∑c k√©o th·∫£ ·∫£nh v√†o ƒë√¢y</h3>
                <p style="color: #666;">H·ªó tr·ª£: JPG, PNG, WEBP</p>
                <input type="file" id="ocr-file-input" accept="image/*" style="display: none;" onchange="handleOCRUpload(event)">
            </div>

            <div id="ocr-progress" style="display: none;">
                <p style="text-align: center; margin-bottom: 10px; font-weight: 600;">ƒêang nh·∫≠n di·ªán... <span id="ocr-progress-text">0%</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="ocr-progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <div id="ocr-result-container" style="display: none;">
                <h3 style="margin-bottom: 15px;">üìù K·∫øt qu·∫£ nh·∫≠n di·ªán:</h3>
                <div class="ocr-result" id="ocr-result-text"></div>
                <button class="btn btn-primary" onclick="copyOCRResult()">üìã Copy vƒÉn b·∫£n</button>
            </div>
        </div>

        <!-- Tab: AI Helper -->
        <div id="ai-helper-tab" class="tab-content">
            <div class="info-banner">
                <h3>ü§ñ S·ª≠ d·ª•ng AI b√™n ngo√†i ƒë·ªÉ d·ªãch t·ª´ v·ª±ng</h3>
                <p>Website n√†y KH√îNG t√≠ch h·ª£p AI ƒë·ªÉ ƒë·∫£m b·∫£o ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh v√† mi·ªÖn ph√≠. Thay v√†o ƒë√≥, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ChatGPT, Gemini, ho·∫∑c Claude v·ªõi prompt c√≥ s·∫µn b√™n d∆∞·ªõi.</p>
            </div>

            <div class="prompt-box">
                <h4>üí° Prompt cho AI (ChatGPT / Gemini / Claude)</h4>
                <div class="prompt-text" id="ai-prompt-text">B·∫°n l√† tr·ª£ l√Ω d·ªãch ti·∫øng Trung Ph·ªìn th·ªÉ (Traditional Chinese) sang ti·∫øng Vi·ªát.

H√£y d·ªãch c√°c t·ª´ ti·∫øng Trung sau v√† tr·∫£ l·ªùi theo ƒê√öNG ƒë·ªãnh d·∫°ng:
Ti·∫øng Trung | Pinyin | Ti·∫øng Vi·ªát

V√≠ d·ª•:
‰Ω†Â•Ω | n«ê h«éo | Xin ch√†o
Ë¨ùË¨ù | xi√®xi√® | C·∫£m ∆°n

Danh s√°ch t·ª´ c·∫ßn d·ªãch:
[ƒêI·ªÄN C√ÅC T·ª™ ·ªû ƒê√ÇY]</div>
                <button class="copy-btn" onclick="copyPrompt()">üìã Copy Prompt</button>
            </div>

            <div class="info-banner" style="margin-top: 25px;">
                <h3>üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</h3>
                <p><strong>B∆∞·ªõc 1:</strong> Copy prompt ·ªü tr√™n</p>
                <p><strong>B∆∞·ªõc 2:</strong> Thay [ƒêI·ªÄN C√ÅC T·ª™ ·ªû ƒê√ÇY] b·∫±ng danh s√°ch t·ª´ ti·∫øng Trung c·ªßa b·∫°n</p>
                <p><strong>B∆∞·ªõc 3:</strong> D√°n v√†o ChatGPT/Gemini/Claude</p>
                <p><strong>B∆∞·ªõc 4:</strong> Copy k·∫øt qu·∫£ AI tr·∫£ v·ªÅ</p>
                <p><strong>B∆∞·ªõc 5:</strong> V√†o b√†i h·ªçc ‚Üí "Th√™m nhi·ªÅu t·ª´" ‚Üí D√°n k·∫øt qu·∫£ v√†o</p>
            </div>

            <div style="margin-top: 25px;">
                <h3 style="margin-bottom: 15px;">üîó Link c√°c AI mi·ªÖn ph√≠:</h3>
                <button class="btn btn-info" onclick="window.open('https://chat.openai.com', '_blank')">ChatGPT (OpenAI)</button>
                <button class="btn btn-info" onclick="window.open('https://gemini.google.com', '_blank')">Gemini (Google)</button>
                <button class="btn btn-info" onclick="window.open('https://claude.ai', '_blank')">Claude (Anthropic)</button>
            </div>
        </div>
    </div>

    <!-- Modal: Th√™m b√†i h·ªçc -->
    <div id="add-lesson-modal" class="modal">
        <div class="modal-content">
            <h2>üìù Th√™m b√†i h·ªçc m·ªõi</h2>
            <div class="form-group">
                <label>T√™n b√†i h·ªçc:</label>
                <input type="text" id="lesson-name" placeholder="V√≠ d·ª•: B√†i 1 - Ch√†o h·ªèi">
            </div>
            <button class="btn btn-primary" onclick="addLesson()">Th√™m</button>
            <button class="btn btn-outline" onclick="closeModal('add-lesson-modal')">H·ªßy</button>
        </div>
    </div>

    <!-- Modal: Chi ti·∫øt b√†i h·ªçc -->
    <div id="lesson-detail-modal" class="modal">
        <div class="modal-content">
            <h2 id="lesson-detail-title">Chi ti·∫øt b√†i h·ªçc</h2>
            <button class="btn btn-primary" onclick="showAddVocabModal()">‚ûï Th√™m t·ª´ v·ª±ng</button>
            <button class="btn btn-secondary" onclick="showBulkAddModal()">üìã Th√™m nhi·ªÅu t·ª´</button>
            <div id="vocab-list" class="vocab-list"></div>
            <button class="btn btn-outline" onclick="closeModal('lesson-detail-modal')" style="margin-top: 25px;">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Modal: Th√™m t·ª´ v·ª±ng -->
    <div id="add-vocab-modal" class="modal">
        <div class="modal-content">
            <h2>‚ûï Th√™m t·ª´ v·ª±ng</h2>
            <div class="form-group">
                <label>Ti·∫øng Trung (Ph·ªìn th·ªÉ):</label>
                <input type="text" id="vocab-chinese" placeholder="‰Ω†Â•Ω">
            </div>
            <div class="form-group">
                <label>Pinyin:</label>
                <input type="text" id="vocab-pinyin" placeholder="n«ê h«éo">
            </div>
            <div class="form-group">
                <label>Nghƒ©a ti·∫øng Vi·ªát:</label>
                <input type="text" id="vocab-vietnamese" placeholder="Xin ch√†o">
            </div>
            <button class="btn btn-primary" onclick="addVocab()">Th√™m</button>
            <button class="btn btn-outline" onclick="closeModal('add-vocab-modal')">H·ªßy</button>
        </div>
    </div>

    <!-- Modal: Th√™m nhi·ªÅu t·ª´ -->
    <div id="bulk-add-modal" class="modal">
        <div class="modal-content">
            <h2>üìã Th√™m nhi·ªÅu t·ª´ v·ª±ng</h2>
            
            <div class="info-banner">
                <h3>üìù ƒê·ªãnh d·∫°ng:</h3>
                <p>M·ªói d√≤ng m·ªôt t·ª´, theo c√∫ ph√°p: <strong>Ti·∫øng Trung | Pinyin | Ti·∫øng Vi·ªát</strong></p>
                <p style="margin-top: 8px;"><strong>V√≠ d·ª•:</strong></p>
                <pre style="background: white; padding: 12px; border-radius: 6px; margin-top: 8px;">‰Ω†Â•Ω | n«ê h«éo | Xin ch√†o
Ë¨ùË¨ù | xi√®xi√® | C·∫£m ∆°n
ÂÜçË¶ã | z√†iji√†n | T·∫°m bi·ªát</pre>
            </div>

            <div class="form-group">
                <label>Nh·∫≠p danh s√°ch t·ª´ v·ª±ng:</label>
                <textarea id="bulk-vocab-input" placeholder="‰Ω†Â•Ω | n«ê h«éo | Xin ch√†o&#10;Ë¨ùË¨ù | xi√®xi√® | C·∫£m ∆°n&#10;ÂÜçË¶ã | z√†iji√†n | T·∫°m bi·ªát"></textarea>
                <div class="hint">üí° Tip: S·ª≠ d·ª•ng AI (tab "AI Helper") ƒë·ªÉ d·ªãch h√†ng lo·∫°t t·ª´ v·ª±ng!</div>
            </div>
            <div id="bulk-status"></div>
            <button class="btn btn-success" onclick="bulkAddVocabs()">üì• Th√™m t·∫•t c·∫£</button>
            <button class="btn btn-outline" onclick="closeModal('bulk-add-modal')">H·ªßy</button>
        </div>
    </div>

    <script>
        // ==================== DATA ====================
        let lessons = JSON.parse(localStorage.getItem('lessons')) || [];
        let currentLessonId = null;
        let currentFlashcardIndex = 0;
        let currentExerciseIndex = 0;
        let exerciseScore = 0;
        let exerciseVocabs = [];

        // ==================== INIT ====================
        function init() {
            renderLessons();
            updateLessonSelects();
            setupOCRDragDrop();
        }

        // ==================== TAB SWITCHING ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        // ==================== MODAL ====================
        function showAddLessonModal() {
            document.getElementById('add-lesson-modal').classList.add('active');
        }

        function showAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.add('active');
        }

        function showBulkAddModal() {
            document.getElementById('bulk-add-modal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ==================== LESSONS ====================
        function addLesson() {
            const name = document.getElementById('lesson-name').value.trim();
            if (!name) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n b√†i h·ªçc!');
                return;
            }

            const lesson = {
                id: Date.now(),
                name: name,
                vocabs: []
            };

            lessons.push(lesson);
            saveLessons();
            renderLessons();
            updateLessonSelects();
            closeModal('add-lesson-modal');
            document.getElementById('lesson-name').value = '';
        }

        function deleteLesson(lessonId) {
            if (confirm('‚ùì B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i h·ªçc n√†y?')) {
                lessons = lessons.filter(l => l.id !== lessonId);
                saveLessons();
                renderLessons();
                updateLessonSelects();
            }
        }

        function openLessonDetail(lessonId) {
            currentLessonId = lessonId;
            const lesson = lessons.find(l => l.id === lessonId);
            document.getElementById('lesson-detail-title').textContent = lesson.name;
            renderVocabs();
            document.getElementById('lesson-detail-modal').classList.add('active');
        }

        function renderLessons() {
            const container = document.getElementById('lesson-list');
            
            if (lessons.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <div class="empty-state-text">Ch∆∞a c√≥ b√†i h·ªçc n√†o. H√£y th√™m b√†i h·ªçc ƒë·∫ßu ti√™n!</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = lessons.map(lesson => `
                <div class="lesson-card" onclick="openLessonDetail(${lesson.id})">
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteLesson(${lesson.id})">√ó</button>
                    <h3>${lesson.name}</h3>
                    <div class="vocab-count">üìù ${lesson.vocabs.length} t·ª´ v·ª±ng</div>
                </div>
            `).join('');
        }

        // ==================== VOCABULARIES ====================
        function addVocab() {
            const chinese = document.getElementById('vocab-chinese').value.trim();
            const pinyin = document.getElementById('vocab-pinyin').value.trim();
            const vietnamese = document.getElementById('vocab-vietnamese').value.trim();

            if (!chinese || !pinyin || !vietnamese) {
                alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }

            const lesson = lessons.find(l => l.id === currentLessonId);
            lesson.vocabs.push({
                id: Date.now(),
                chinese,
                pinyin,
                vietnamese
            });

            saveLessons();
            renderVocabs();
            renderLessons();
            closeModal('add-vocab-modal');
            
            document.getElementById('vocab-chinese').value = '';
            document.getElementById('vocab-pinyin').value = '';
            document.getElementById('vocab-vietnamese').value = '';
        }

        function bulkAddVocabs() {
            const input = document.getElementById('bulk-vocab-input').value.trim();
            
            if (!input) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p danh s√°ch t·ª´ v·ª±ng!');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());
            const statusDiv = document.getElementById('bulk-status');
            const lesson = lessons.find(l => l.id === currentLessonId);
            
            let addedCount = 0;
            let errorCount = 0;

            lines.forEach((line, i) => {
                const parts = line.split('|').map(p => p.trim());

                if (parts.length >= 3) {
                    lesson.vocabs.push({
                        id: Date.now() + i,
                        chinese: parts[0],
                        pinyin: parts[1],
                        vietnamese: parts[2]
                    });
                    addedCount++;
                } else {
                    errorCount++;
                }
            });

            saveLessons();
            renderVocabs();
            renderLessons();
            
            statusDiv.innerHTML = `
                <div style="background: ${errorCount > 0 ? '#fff3cd' : '#d4edda'}; color: ${errorCount > 0 ? '#856404' : '#155724'}; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    ‚úÖ ƒê√£ th√™m ${addedCount} t·ª´ v·ª±ng!
                    ${errorCount > 0 ? `<br>‚ö†Ô∏è ${errorCount} d√≤ng b·ªã l·ªói (sai ƒë·ªãnh d·∫°ng)` : ''}
                </div>
            `;

            document.getElementById('bulk-vocab-input').value = '';
            
            setTimeout(() => {
                closeModal('bulk-add-modal');
                statusDiv.innerHTML = '';
            }, 2000);
        }

        function deleteVocab(vocabId) {
            if (confirm('‚ùì B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·ª´ v·ª±ng n√†y?')) {
                const lesson = lessons.find(l => l.id === currentLessonId);
                lesson.vocabs = lesson.vocabs.filter(v => v.id !== vocabId);
                saveLessons();
                renderVocabs();
                renderLessons();
            }
        }

        function renderVocabs() {
            const container = document.getElementById('vocab-list');
            const lesson = lessons.find(l => l.id === currentLessonId);
            
            if (lesson.vocabs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">Ch∆∞a c√≥ t·ª´ v·ª±ng n√†o. H√£y th√™m t·ª´ v·ª±ng!</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = lesson.vocabs.map(vocab => `
                <div class="vocab-item">
                    <div class="vocab-info">
                        <div class="vocab-chinese">${vocab.chinese}</div>
                        <div class="vocab-pinyin">${vocab.pinyin}</div>
                        <div class="vocab-vietnamese">${vocab.vietnamese}</div>
                    </div>
                    <div class="vocab-actions">
                        <button class="vocab-speak" onclick="speakChinese('${vocab.chinese}')">üîä</button>
                        <button class="vocab-delete" onclick="deleteVocab(${vocab.id})">X√≥a</button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== TEXT-TO-SPEECH ====================
        function speakChinese(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-TW';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                
                window.speechSynthesis.speak(utterance);
            } else {
                alert('‚ö†Ô∏è Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n!');
            }
        }

        // ==================== FLASHCARDS ====================
        function updateLessonSelects() {
            const flashcardSelect = document.getElementById('flashcard-lesson-select');
            const exerciseSelect = document.getElementById('exercise-lesson-select');
            
            const options = lessons.map(lesson => 
                `<option value="${lesson.id}">${lesson.name} (${lesson.vocabs.length} t·ª´)</option>`
            ).join('');

            flashcardSelect.innerHTML = '<option value="">-- Ch·ªçn b√†i h·ªçc --</option>' + options;
            exerciseSelect.innerHTML = '<option value="">-- Ch·ªçn b√†i h·ªçc --</option>' + options;
        }

        function loadFlashcards() {
            const lessonId = parseInt(document.getElementById('flashcard-lesson-select').value);
            if (!lessonId) {
                document.getElementById('flashcard-area').innerHTML = '';
                return;
            }

            const lesson = lessons.find(l => l.id === lessonId);
            if (lesson.vocabs.length === 0) {
                document.getElementById('flashcard-area').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üé¥</div>
                        <div class="empty-state-text">B√†i h·ªçc n√†y ch∆∞a c√≥ t·ª´ v·ª±ng!</div>
                    </div>
                `;
                return;
            }

            currentFlashcardIndex = 0;
            renderFlashcard(lesson);
        }

        function renderFlashcard(lesson) {
            const vocab = lesson.vocabs[currentFlashcardIndex];
            const container = document.getElementById('flashcard-area');
            
            container.innerHTML = `
                <div class="flashcard-container">
                    <div style="margin-bottom: 22px; font-size: 1.3em; color: #667eea; font-weight: bold;">
                        T·ª´ ${currentFlashcardIndex + 1} / ${lesson.vocabs.length}
                    </div>
                    <div class="flashcard" id="current-flashcard" onclick="flipCard()">
                        <div class="flashcard-front">
                            <div class="flashcard-text">${vocab.chinese}</div>
                            <div class="flashcard-sub">${vocab.pinyin}</div>
                            <button class="speak-btn" onclick="event.stopPropagation(); speakChinese('${vocab.chinese}')">
                                üîä Nghe ph√°t √¢m
                            </button>
                            <div style="margin-top: 22px; opacity: 0.8; font-size: 0.95em;">üëÜ Nh·∫•n ƒë·ªÉ l·∫≠t th·∫ª</div>
                        </div>
                        <div class="flashcard-back">
                            <div class="flashcard-text">${vocab.vietnamese}</div>
                            <div class="flashcard-sub">${vocab.chinese} (${vocab.pinyin})</div>
                            <button class="speak-btn" onclick="event.stopPropagation(); speakChinese('${vocab.chinese}')">
                                üîä Nghe ph√°t √¢m
                            </button>
                            <div style="margin-top: 22px; opacity: 0.8; font-size: 0.95em;">üëÜ Nh·∫•n ƒë·ªÉ l·∫≠t th·∫ª</div>
                        </div>
                    </div>
                    <div class="flashcard-controls">
                        <button class="control-btn" style="background: #6c757d; color: white;" 
                                onclick="previousCard()" ${currentFlashcardIndex === 0 ? 'disabled' : ''}>
                            ‚Üê Tr∆∞·ªõc
                        </button>
                        <button class="control-btn" style="background: #667eea; color: white;" 
                                onclick="nextCard()" ${currentFlashcardIndex === lesson.vocabs.length - 1 ? 'disabled' : ''}>
                            Sau ‚Üí
                        </button>
                    </div>
                </div>
            `;
        }

        function flipCard() {
            document.getElementById('current-flashcard').classList.toggle('flipped');
        }

        function previousCard() {
            const lessonId = parseInt(document.getElementById('flashcard-lesson-select').value);
            const lesson = lessons.find(l => l.id === lessonId);
            
            if (currentFlashcardIndex > 0) {
                currentFlashcardIndex--;
                renderFlashcard(lesson);
            }
        }

        function nextCard() {
            const lessonId = parseInt(document.getElementById('flashcard-lesson-select').value);
            const lesson = lessons.find(l => l.id === lessonId);
            
            if (currentFlashcardIndex < lesson.vocabs.length - 1) {
                currentFlashcardIndex++;
                renderFlashcard(lesson);
            }
        }

        // ==================== EXERCISES ====================
        function startExercise() {
            const lessonId = parseInt(document.getElementById('exercise-lesson-select').value);
            if (!lessonId) {
                alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn b√†i h·ªçc!');
                return;
            }

            const lesson = lessons.find(l => l.id === lessonId);
            if (lesson.vocabs.length < 2) {
                alert('‚ö†Ô∏è B√†i h·ªçc c·∫ßn c√≥ √≠t nh·∫•t 2 t·ª´ v·ª±ng ƒë·ªÉ l√†m b√†i t·∫≠p!');
                return;
            }

            exerciseVocabs = [...lesson.vocabs].sort(() => Math.random() - 0.5);
            currentExerciseIndex = 0;
            exerciseScore = 0;
            renderExerciseQuestion();
        }

        function renderExerciseQuestion() {
            if (currentExerciseIndex >= exerciseVocabs.length) {
                showExerciseResult();
                return;
            }

            const container = document.getElementById('exercise-area');
            const correctVocab = exerciseVocabs[currentExerciseIndex];
            const allVocabs = [...exerciseVocabs];
            
            const options = [correctVocab];
            while (options.length < Math.min(4, allVocabs.length)) {
                const randomVocab = allVocabs[Math.floor(Math.random() * allVocabs.length)];
                if (!options.find(v => v.id === randomVocab.id)) {
                    options.push(randomVocab);
                }
            }
            
            options.sort(() => Math.random() - 0.5);

            container.innerHTML = `
                <div class="exercise-container">
                    <div class="score-display">
                        C√¢u ${currentExerciseIndex + 1}/${exerciseVocabs.length} | ƒêi·ªÉm: ${exerciseScore}
                    </div>
                    <div class="question-card">
                        <div class="question-text">T·ª´ n√†y c√≥ nghƒ©a l√† g√¨?</div>
                        <div class="question-chinese">${correctVocab.chinese}</div>
                        <div style="text-align: center; color: #666; margin-top: 12px; font-size: 1.1em;">
                            ${correctVocab.pinyin}
                            <button class="speak-btn" onclick="speakChinese('${correctVocab.chinese}')" style="margin-left: 12px; color: #667eea;">
                                üîä
                            </button>
                        </div>
                        <div class="options">
                            ${options.map((option, index) => `
                                <button class="option-btn" onclick="checkAnswer(${option.id}, ${correctVocab.id})">
                                    ${String.fromCharCode(65 + index)}. ${option.vietnamese}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function checkAnswer(selectedId, correctId) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.disabled = true);

            const selectedBtn = Array.from(buttons).find(btn => 
                btn.onclick.toString().includes(`checkAnswer(${selectedId}`)
            );

            if (selectedId === correctId) {
                selectedBtn.classList.add('correct');
                exerciseScore++;
            } else {
                selectedBtn.classList.add('incorrect');
                const correctBtn = Array.from(buttons).find(btn => 
                    btn.onclick.toString().includes(`checkAnswer(${correctId}`)
                );
                correctBtn.classList.add('correct');
            }

            setTimeout(() => {
                currentExerciseIndex++;
                renderExerciseQuestion();
            }, 1500);
        }

        function showExerciseResult() {
            const container = document.getElementById('exercise-area');
            const percentage = Math.round((exerciseScore / exerciseVocabs.length) * 100);
            
            let message = '';
            let emoji = '';
            if (percentage >= 80) {
                message = 'Xu·∫•t s·∫Øc!';
                emoji = 'üéâ';
            } else if (percentage >= 60) {
                message = 'Kh√° t·ªët!';
                emoji = 'üëç';
            } else {
                message = 'C·ªë g·∫Øng l√™n!';
                emoji = 'üí™';
            }

            container.innerHTML = `
                <div class="exercise-container">
                    <div class="question-card" style="text-align: center;">
                        <div style="font-size: 5em; margin-bottom: 25px;">${emoji}</div>
                        <h2 style="color: #667eea; margin-bottom: 25px; font-size: 2.5em;">${message}</h2>
                        <div class="score-display" style="font-size: 2.5em;">
                            ƒêi·ªÉm: ${exerciseScore}/${exerciseVocabs.length}
                        </div>
                        <div style="font-size: 2em; margin: 25px 0; color: #666;">
                            ${percentage}%
                        </div>
                        <button class="btn btn-success" onclick="startExercise()">
                            üîÑ L√†m l·∫°i
                        </button>
                    </div>
                </div>
            `;
        }

        // ==================== OCR ====================
        function setupOCRDragDrop() {
            const dropZone = document.getElementById('ocr-drop-zone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.add('dragging');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.remove('dragging');
                }, false);
            });

            dropZone.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processOCRImage(files[0]);
                }
            }, false);
        }

        function handleOCRUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processOCRImage(file);
            }
        }

        function processOCRImage(file) {
            if (!file.type.startsWith('image/')) {
                alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn file ·∫£nh!');
                return;
            }

            document.getElementById('ocr-progress').style.display = 'block';
            document.getElementById('ocr-result-container').style.display = 'none';

            Tesseract.recognize(
                file,
                'chi_tra',  // Traditional Chinese
                {
                    logger: info => {
                        if (info.status === 'recognizing text') {
                            const progress = Math.round(info.progress * 100);
                            document.getElementById('ocr-progress-text').textContent = progress + '%';
                            document.getElementById('ocr-progress-bar').style.width = progress + '%';
                        }
                    }
                }
            ).then(({ data: { text } }) => {
                document.getElementById('ocr-progress').style.display = 'none';
                document.getElementById('ocr-result-container').style.display = 'block';
                document.getElementById('ocr-result-text').textContent = text || 'Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c vƒÉn b·∫£n';
            }).catch(err => {
                console.error('OCR Error:', err);
                document.getElementById('ocr-progress').style.display = 'none';
                alert('‚ùå L·ªói khi nh·∫≠n di·ªán ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i!');
            });
        }

        function copyOCRResult() {
            const text = document.getElementById('ocr-result-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ ƒê√£ copy vƒÉn b·∫£n!');
            });
        }

        // ==================== AI HELPER ====================
        function copyPrompt() {
            const text = document.getElementById('ai-prompt-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ ƒê√£ copy prompt! H√£y d√°n v√†o ChatGPT/Gemini/Claude');
            });
        }

        // ==================== STORAGE ====================
        function saveLessons() {
            localStorage.setItem('lessons', JSON.stringify(lessons));
        }

        // ==================== START ====================
        init();
    </script>
</body>
</html>
